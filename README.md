# AMASS-Motion-Auto-Pipeline 🏃‍♂️🤖

本项目提供了一套完整的流水线，用于将混乱的 **AMASS** 动作捕获数据（`.npz` 格式）自动分类为 17 个特定的运动类别。

系统采用 **“规则硬筛 + 深度学习自进化”** 的架构，解决了大规模动作数据手动标注难、长尾数据多、`others` 类别庞大的痛点。

---

## 🏗️ 全流程架构

系统分为两个阶段运行，形成一个从“特征工程”到“模型智能”的闭环：

### 第一阶段：`classify_complete.py` (物理规则粗分类)

利用人体运动学先验知识（Heuristics），通过解析根节点位移（Root Translation）和关节旋转（DoF）提取物理特征。

* **关键词匹配**：根据文件名（如 `walk`, `run`）进行初步分类。
* **物理决策树**：利用水平速度 、垂直振幅  和关节动能  的阈值判定无特征名称的文件。
* **输出**：通过 `os.link` 建立硬链接，快速生成初步文件夹结构。

### 第二阶段：`train_supervised.py` (自训练深度学习迭代)

采用 **自训练 (Self-Training)** 半监督学习方案。

* **初始训练**：以第一阶段的“高质量”样本作为种子集训练 **Bi-LSTM** 分类器。
* **暴力挖掘**：对 `others` 文件夹中的样本进行推理。
* **动态搬运**：置信度达到门槛（ 动态下降）的样本自动 `shutil.move` 到对应类别。
* **循环进化**：新样本加入训练集，开始下一轮（共 30 轮）迭代。

---

## 📊 实验结果 (Experimental Results)

通过 15 轮迭代，系统展现了极强的特征提取与数据纠错能力：

| 指标 | 初始状态 (Round 0) | 最终状态 (Round 15+) |
| --- | --- | --- |
| **训练集规模** | ~5,869 样本 | **14,013 样本** |
| **待处理池 (Others)** | 几万个文件 | **16 个文件** |
| **训练准确率 (Acc)** | ~30% | **98% 以上** |

---

## 🚀 快速开始

### 1. 环境准备

```bash
pip install torch numpy tqdm pathlib

```

### 2. 执行第一阶段：粗分类

修改 `classify_complete.py` 中的 `SOURCE_DIR` (原始数据) 和 `TARGET_DIR` (输出路径)：

```bash
python classify_complete.py

```

### 3. 执行第二阶段：自训练进化

修改脚本中的 `ROOT_DIR` 为第一阶段的 `TARGET_DIR`：

```bash
python train_supervised.py

```

---

## 🛠️ 技术细节

### 物理特征定义 (Stage 1)

| 缩写 | 含义 | 判别用途 |
| --- | --- | --- |
| **h** | 平均水平速度 | 区分静止 (Pose) 与移动 (Walk/Run) |
| **vr** | 高度变化范围 | 区分地面动作 (Ground) 与跳跃 (Jump) |
| **j** | 关节平均活动度 | 区分轻微手势 (Gesture) 与剧烈搏击 (Fight) |
| **u/l** | 上/下肢活跃比 | 区分投掷 (Throw) 与行走 (Locomotion) |

### 模型架构 (Stage 2)

* **输入层**：72 维动作特征（SMPL 参数），支持 Padding/Clipping 保持  帧。
* **隐含层**：双层双向 LSTM ()，捕获时序依赖。
* **输出层**：全连接层输出 17 类 Logits。

---

## ⚠️ 注意事项

* **数据备份**：第二阶段涉及 `shutil.move` 物理移动，操作不可逆，**运行前务必备份**。
* **确认偏误**：半监督学习可能带入错误标注。建议迭代后对 `auto_r{N}_` 前缀文件进行抽样人工检查。
* **IO 负载**：30 轮迭代涉及大量磁盘读写，建议在 SSD 上运行。
﻿
